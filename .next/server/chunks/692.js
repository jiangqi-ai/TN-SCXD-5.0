exports.id=692,exports.ids=[692],exports.modules={2213:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2213,e.exports=t},8359:()=>{},3739:()=>{},6976:(e,t,s)=>{Promise.resolve().then(s.bind(s,7896)),Promise.resolve().then(s.bind(s,5332)),Promise.resolve().then(s.bind(s,5256))},4178:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,3579,23)),Promise.resolve().then(s.t.bind(s,619,23)),Promise.resolve().then(s.t.bind(s,1459,23)),Promise.resolve().then(s.t.bind(s,3456,23)),Promise.resolve().then(s.t.bind(s,847,23)),Promise.resolve().then(s.t.bind(s,7303,23))},7896:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,useAuth:()=>o});var i=s(3854),a=s(4218),r=s(3984);let n=(0,a.createContext)(void 0);function o(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function l({children:e}){let[t,s]=(0,a.useState)(null),[o,l]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),d=(0,r.JU)(),h=async()=>{if(!t)return;let{data:e}=await d.from("profiles").select("*").eq("id",t.id).single();l(e)},m=async()=>{await d.auth.signOut(),s(null),l(null)};return(0,a.useEffect)(()=>{let e=async()=>{let{data:{user:e}}=await d.auth.getUser();s(e),e&&await h(),u(!1)};e();let{data:{subscription:t}}=d.auth.onAuthStateChange(async(e,t)=>{s(t?.user??null),t?.user?await h():l(null),u(!1)});return()=>t.unsubscribe()},[t?.id]),i.jsx(n.Provider,{value:{user:t,profile:o,loading:c,signOut:m,refreshProfile:h},children:e})}},5332:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var i=s(3854),a=s(5548),r=s.n(a),n=s(7896),o=s(5620),l=s(2978),c=s(7112),u=s(1871),d=s(6934),h=s(518),m=s(1880),f=s(4218);function y(){let{user:e,profile:t,signOut:s}=(0,n.useAuth)(),{items:a}=(0,o.j)(),[y,x]=(0,f.useState)(!1),g=a.reduce((e,t)=>e+t.quantity,0);return i.jsx("nav",{className:"fixed top-0 left-0 right-0 bg-white shadow-lg z-50",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,i.jsxs)(r(),{href:"/",className:"flex items-center space-x-2",children:[i.jsx(l.Z,{className:"h-8 w-8 text-primary-600"}),i.jsx("span",{className:"text-xl font-bold text-gray-900",children:"攀岩装备"})]}),(0,i.jsxs)("div",{className:"hidden md:flex items-center space-x-8",children:[i.jsx(r(),{href:"/products",className:"text-gray-700 hover:text-primary-600 transition-colors",children:"产品中心"}),e&&i.jsx(r(),{href:"/orders",className:"text-gray-700 hover:text-primary-600 transition-colors",children:"订单中心"}),t?.role==="admin"&&i.jsx(r(),{href:"/admin",className:"text-gray-700 hover:text-primary-600 transition-colors",children:"管理后台"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsxs)(r(),{href:"/cart",className:"relative p-2 text-gray-700 hover:text-primary-600 transition-colors",children:[i.jsx(c.Z,{className:"h-6 w-6"}),g>0&&i.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:g})]}),e?(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)("button",{onClick:()=>x(!y),className:"flex items-center space-x-2 text-gray-700 hover:text-primary-600 transition-colors",children:[i.jsx(u.Z,{className:"h-6 w-6"}),i.jsx("span",{className:"hidden md:block",children:t?.full_name||e.email})]}),y&&(0,i.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50",children:[(0,i.jsxs)(r(),{href:"/profile",className:"flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100",onClick:()=>x(!1),children:[i.jsx(u.Z,{className:"h-4 w-4 mr-2"}),"个人资料"]}),(0,i.jsxs)(r(),{href:"/orders",className:"flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100",onClick:()=>x(!1),children:[i.jsx(d.Z,{className:"h-4 w-4 mr-2"}),"我的订单"]}),t?.role==="admin"&&(0,i.jsxs)(r(),{href:"/admin",className:"flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100",onClick:()=>x(!1),children:[i.jsx(h.Z,{className:"h-4 w-4 mr-2"}),"管理后台"]}),(0,i.jsxs)("button",{onClick:()=>{s(),x(!1)},className:"flex items-center w-full px-4 py-2 text-gray-700 hover:bg-gray-100",children:[i.jsx(m.Z,{className:"h-4 w-4 mr-2"}),"退出登录"]})]})]}):(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[i.jsx(r(),{href:"/auth/login",className:"text-gray-700 hover:text-primary-600 transition-colors",children:"登录"}),i.jsx(r(),{href:"/auth/register",className:"btn-primary",children:"注册"})]})]})]})})})}},1870:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var i=s(5450);class a{static{this.instance={config:null,client:null,initialized:!1}}static getDefaultConfig(){let e="https://demo-project.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo";return e&&t?{url:e,anonKey:t,serviceRoleKey:process.env.SUPABASE_SERVICE_ROLE_KEY,connectionPool:10,timeout:30}:null}static async loadConfigFromDatabase(){try{let e=this.getDefaultConfig();if(!e)return console.warn("No default config available, cannot load from database"),null;let t=(0,i.eI)(e.url,e.anonKey),{data:s,error:a}=await t.from("settings").select("key, value").in("key",["db_url","db_anon_key","db_service_key","db_connection_pool","db_timeout"]);if(a)return console.warn("Failed to load config from database:",a),e;if(!s||0===s.length)return console.log("No database config found, using default"),e;let r={};s.forEach(e=>{switch(e.key){case"db_url":r.url=e.value;break;case"db_anon_key":r.anonKey=e.value;break;case"db_service_key":r.serviceRoleKey=e.value;break;case"db_connection_pool":r.connectionPool=parseInt(e.value)||10;break;case"db_timeout":r.timeout=parseInt(e.value)||30}});let n={url:r.url||e.url,anonKey:r.anonKey||e.anonKey,serviceRoleKey:r.serviceRoleKey||e.serviceRoleKey,connectionPool:r.connectionPool||10,timeout:r.timeout||30};return console.log("Loaded config from database successfully"),n}catch(e){return console.error("Error loading config from database:",e),this.getDefaultConfig()}}static async initialize(){if(this.instance.initialized&&this.instance.client)return this.instance.client;try{let e=await this.loadConfigFromDatabase();if(e||(e=this.getDefaultConfig()),!e)return console.error("No valid Supabase configuration found"),null;let t=(0,i.eI)(e.url,e.anonKey,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}});return this.instance.config=e,this.instance.client=t,this.instance.initialized=!0,console.log("Supabase client initialized successfully"),t}catch(e){return console.error("Failed to initialize Supabase client:",e),null}}static getClient(){return this.instance.client}static getConfig(){return this.instance.config}static async reloadConfig(){return this.instance.initialized=!1,this.instance.client=null,this.instance.config=null,await this.initialize()}static async updateConfig(e){try{let t=this.getClient();if(!t)throw Error("No client available for config update");let s=[];for(let i of(e.url&&s.push({key:"db_url",value:e.url,category:"database",is_public:!1}),e.anonKey&&s.push({key:"db_anon_key",value:e.anonKey,category:"database",is_public:!1}),e.serviceRoleKey&&s.push({key:"db_service_key",value:e.serviceRoleKey,category:"database",is_public:!1}),void 0!==e.connectionPool&&s.push({key:"db_connection_pool",value:e.connectionPool.toString(),category:"database",is_public:!1}),void 0!==e.timeout&&s.push({key:"db_timeout",value:e.timeout.toString(),category:"database",is_public:!1}),s)){let{error:e}=await t.from("settings").upsert(i,{onConflict:"key"});if(e)throw e}return await this.reloadConfig(),console.log("Database config updated successfully"),!0}catch(e){return console.error("Failed to update database config:",e),!1}}static async checkConnection(){try{let e=this.getClient();if(!e)return{connected:!1,error:"No client available"};let{data:t,error:s}=await e.from("settings").select("count").limit(1);if(s)return{connected:!1,error:s.message};return{connected:!0}}catch(e){return{connected:!1,error:e.message}}}}let r=a},3984:(e,t,s)=>{"use strict";s.d(t,{JU:()=>r});var i=s(5450),a=s(1870);function r(){let e=a.Z.getClient();if(e)return e;let t="https://demo-project.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo";if(!t)throw console.error("Missing NEXT_PUBLIC_SUPABASE_URL environment variable"),Error("Supabase URL is required");if(!s)throw console.error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable"),Error("Supabase Anonymous Key is required");let r=(0,i.eI)(t,s,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}});return r}r()},5620:(e,t,s)=>{"use strict";s.d(t,{j:()=>r});var i=s(4012),a=s(6965);let r=(0,i.Ue)()((0,a.tJ)((e,t)=>({items:[],addItem:s=>{let i=t().items,a=i.find(e=>e.id===s.id);a?e({items:i.map(e=>e.id===s.id?{...e,quantity:Math.min(e.quantity+1,s.stock_quantity)}:e)}):e({items:[...i,{...s,quantity:1}]})},removeItem:s=>{e({items:t().items.filter(e=>e.id!==s)})},updateQuantity:(s,i)=>{if(i<=0){t().removeItem(s);return}e({items:t().items.map(e=>e.id===s?{...e,quantity:Math.min(i,e.stock_quantity)}:e)})},clearCart:()=>{e({items:[]})},getTotalPrice:()=>t().items.reduce((e,t)=>e+t.price*t.quantity,0),getTotalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0)}),{name:"cart-storage"}))},623:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g,metadata:()=>x});var i=s(4656),a=s(2999),r=s.n(a);s(7272);var n=s(8204),o=s(5153);let l=(0,o.createProxy)(String.raw`E:\starter-template\TN-SCXD-5.0\components\Navigation.tsx`),{__esModule:c,$$typeof:u}=l,d=l.default,h=(0,o.createProxy)(String.raw`E:\starter-template\TN-SCXD-5.0\components\AuthProvider.tsx`),{__esModule:m,$$typeof:f}=h,y=h.default;(0,o.createProxy)(String.raw`E:\starter-template\TN-SCXD-5.0\components\AuthProvider.tsx#useAuth`);let x={title:"攀岩装备商城",description:"专业攀岩装备在线购买平台"};function g({children:e}){return i.jsx("html",{lang:"zh-CN",children:i.jsx("body",{className:r().className,children:(0,i.jsxs)(y,{children:[i.jsx(d,{}),i.jsx("main",{className:"min-h-screen pt-16",children:e}),i.jsx(n.x7,{position:"top-right"})]})})})}},7272:()=>{}};