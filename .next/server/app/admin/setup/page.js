(()=>{var e={};e.id=334,e.ids=[334],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},2787:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>o});var r=t(7096),a=t(6132),l=t(7284),i=t.n(l),n=t(2564),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(s,d);let o=["",{children:["admin",{children:["setup",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,529)),"E:\\starter-template\\TN-SCXD-5.0\\app\\admin\\setup\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,623)),"E:\\starter-template\\TN-SCXD-5.0\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\starter-template\\TN-SCXD-5.0\\app\\admin\\setup\\page.tsx"],m="/admin/setup/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/setup/page",pathname:"/admin/setup",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},212:(e,s,t)=>{Promise.resolve().then(t.bind(t,660))},660:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var r=t(3854),a=t(4218),l=t(1018),i=t(3984),n=t(1170),d=t(7413),o=t(1871),c=t(518),m=t(3708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,m.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var x=t(5256);function p(){let e=(0,l.useRouter)(),[s,t]=(0,a.useState)(0),[m,p]=(0,a.useState)(!1),[b,h]=(0,a.useState)({url:"https://demo-project.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo",serviceRoleKey:"",connectionPool:10,timeout:30}),[g,y]=(0,a.useState)({email:"admin@climbing-gear.com",password:"",fullName:"系统管理员"}),[f,j]=(0,a.useState)([{id:"database",title:"数据库配置",description:"配置 Supabase 数据库连接参数",completed:!1,required:!0},{id:"admin",title:"创建管理员账户",description:"设置系统管理员账户",completed:!1,required:!0},{id:"settings",title:"系统设置",description:"配置基本系统参数",completed:!1,required:!1}]),v=(0,i.JU)();(0,a.useEffect)(()=>{N()},[]);let N=async()=>{try{let{data:e}=await v.from("settings").select("count").limit(1);e&&w("database",!0);let{data:s}=await v.from("profiles").select("id").eq("role","admin").limit(1);s&&s.length>0&&w("admin",!0);let{data:t}=await v.from("settings").select("id").limit(1);t&&t.length>0&&w("settings",!0)}catch(e){console.log("检查设置状态时出错:",e)}},w=(e,s)=>{j(t=>t.map(t=>t.id===e?{...t,completed:s}:t))},k=async()=>{p(!0);try{let{data:e,error:s}=await v.from("settings").select("count").limit(1);if(s)throw s;w("database",!0),x.default.success("数据库连接测试成功！"),await _()}catch(e){console.error("数据库连接测试失败:",e),x.default.error("数据库连接测试失败，请检查配置")}finally{p(!1)}},_=async()=>{try{let e=[{key:"db_url",value:b.url,category:"database",is_public:!1},{key:"db_anon_key",value:b.anonKey,category:"database",is_public:!1},{key:"db_service_key",value:b.serviceRoleKey,category:"database",is_public:!1},{key:"db_connection_pool",value:b.connectionPool.toString(),category:"database",is_public:!1},{key:"db_timeout",value:b.timeout.toString(),category:"database",is_public:!1}];for(let s of e)await v.from("settings").upsert(s,{onConflict:"key"});x.default.success("数据库配置已保存")}catch(e){console.error("保存数据库配置失败:",e),x.default.error("保存数据库配置失败")}},C=async()=>{p(!0);try{let{data:e,error:s}=await v.auth.signUp({email:g.email,password:g.password});if(s)throw s;if(e.user){let{error:s}=await v.from("profiles").insert([{id:e.user.id,email:g.email,full_name:g.fullName,role:"admin"}]);if(s)throw s;w("admin",!0),x.default.success("管理员账户创建成功！")}}catch(e){console.error("创建管理员账户失败:",e),x.default.error(`创建管理员账户失败: ${e.message}`)}finally{p(!1)}},q=async()=>{p(!0);try{let e=[{key:"site_name",value:"攀岩装备专营店",category:"general",is_public:!0},{key:"site_description",value:"专业的攀岩装备在线购买平台",category:"general",is_public:!0},{key:"contact_email",value:g.email,category:"contact",is_public:!0},{key:"setup_completed",value:"true",category:"system",is_public:!1},{key:"setup_date",value:new Date().toISOString(),category:"system",is_public:!1}];for(let s of e)await v.from("settings").upsert(s,{onConflict:"key"});w("settings",!0),x.default.success("系统设置初始化完成！")}catch(e){console.error("初始化系统设置失败:",e),x.default.error("初始化系统设置失败")}finally{p(!1)}},I=f.filter(e=>e.required).every(e=>e.completed);return r.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"攀岩装备系统设置"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"欢迎！请按照以下步骤完成系统初始化配置"})]}),r.jsx("div",{className:"mb-8",children:r.jsx("div",{className:"flex items-center justify-between",children:f.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full ${e.completed?"bg-green-500 text-white":s===t?"bg-blue-500 text-white":"bg-gray-300 text-gray-500"}`,children:e.completed?r.jsx(u,{className:"h-4 w-4"}):t+1}),(0,r.jsxs)("div",{className:"ml-3",children:[r.jsx("p",{className:`text-sm font-medium ${e.completed?"text-green-600":"text-gray-900"}`,children:e.title}),r.jsx("p",{className:"text-xs text-gray-500",children:e.description})]}),t<f.length-1&&r.jsx("div",{className:`w-16 h-0.5 mx-4 ${e.completed?"bg-green-500":"bg-gray-300"}`})]},e.id))})}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[0===s&&(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx(n.Z,{className:"h-5 w-5 text-blue-400 mr-3 mt-0.5"}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"数据库配置说明"}),r.jsx("p",{className:"mt-1 text-sm text-blue-700",children:"请填入您的 Supabase 项目配置信息。这些信息可以在 Supabase Dashboard 的 Settings → API 中找到。"})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"项目URL"}),r.jsx("input",{type:"url",value:b.url,onChange:e=>h(s=>({...s,url:e.target.value})),placeholder:"https://your-project-id.supabase.co",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"公开密钥 (anon key)"}),r.jsx("textarea",{value:b.anonKey,onChange:e=>h(s=>({...s,anonKey:e.target.value})),placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"服务密钥 (service_role key)"}),r.jsx("textarea",{value:b.serviceRoleKey,onChange:e=>h(s=>({...s,serviceRoleKey:e.target.value})),placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"连接池大小"}),r.jsx("input",{type:"number",value:b.connectionPool,onChange:e=>h(s=>({...s,connectionPool:parseInt(e.target.value)})),min:"1",max:"50",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"超时时间（秒）"}),r.jsx("input",{type:"number",value:b.timeout,onChange:e=>h(s=>({...s,timeout:parseInt(e.target.value)})),min:"5",max:"120",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]})]}),r.jsx("div",{className:"flex justify-end",children:(0,r.jsxs)("button",{onClick:k,disabled:m||!b.url||!b.anonKey,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:[m?r.jsx(d.Z,{className:"h-4 w-4 mr-2 animate-spin"}):r.jsx(n.Z,{className:"h-4 w-4 mr-2"}),"测试连接"]})})]}),1===s&&(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx(o.Z,{className:"h-5 w-5 text-green-400 mr-3 mt-0.5"}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-green-800",children:"管理员账户"}),r.jsx("p",{className:"mt-1 text-sm text-green-700",children:"创建系统管理员账户，用于访问管理后台和系统配置。"})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"邮箱地址"}),r.jsx("input",{type:"email",value:g.email,onChange:e=>y(s=>({...s,email:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"密码"}),r.jsx("input",{type:"password",value:g.password,onChange:e=>y(s=>({...s,password:e.target.value})),placeholder:"请设置强密码（至少8个字符）",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"姓名"}),r.jsx("input",{type:"text",value:g.fullName,onChange:e=>y(s=>({...s,fullName:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),r.jsx("div",{className:"flex justify-end",children:(0,r.jsxs)("button",{onClick:C,disabled:m||!g.email||!g.password||g.password.length<8,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[m?r.jsx(d.Z,{className:"h-4 w-4 mr-2 animate-spin"}):r.jsx(o.Z,{className:"h-4 w-4 mr-2"}),"创建管理员"]})})]}),2===s&&(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx(c.Z,{className:"h-5 w-5 text-purple-400 mr-3 mt-0.5"}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-purple-800",children:"系统设置"}),r.jsx("p",{className:"mt-1 text-sm text-purple-700",children:"初始化系统基本设置，后续可在管理后台进行修改。"})]})]})}),r.jsx("div",{className:"flex justify-end",children:(0,r.jsxs)("button",{onClick:q,disabled:m,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 disabled:opacity-50",children:[m?r.jsx(d.Z,{className:"h-4 w-4 mr-2 animate-spin"}):r.jsx(c.Z,{className:"h-4 w-4 mr-2"}),"初始化设置"]})})]}),(0,r.jsxs)("div",{className:"mt-8 flex justify-between",children:[r.jsx("button",{onClick:()=>t(Math.max(0,s-1)),disabled:0===s,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"上一步"}),s<f.length-1?r.jsx("button",{onClick:()=>t(Math.min(f.length-1,s+1)),disabled:f[s].required&&!f[s].completed,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:"下一步"}):(0,r.jsxs)("button",{onClick:()=>{x.default.success("系统设置完成！正在跳转到管理后台..."),setTimeout(()=>{e.push("/admin")},2e3)},disabled:!I,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[r.jsx(u,{className:"h-4 w-4 mr-2"}),"完成设置"]})]})]})]})})}},1170:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});var r=t(3708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},7413:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});var r=t(3708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]])},1018:(e,s,t)=>{"use strict";e.exports=t(7804)},529:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>l,default:()=>d});var r=t(5153);let a=(0,r.createProxy)(String.raw`E:\starter-template\TN-SCXD-5.0\app\admin\setup\page.tsx`),{__esModule:l,$$typeof:i}=a,n=a.default,d=n}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[271,502,692],()=>t(2787));module.exports=r})();