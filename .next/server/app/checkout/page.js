(()=>{var e={};e.id=285,e.ids=[285],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},1069:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>o});var r=s(7096),a=s(6132),i=s(7284),l=s.n(i),n=s(2564),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);s.d(t,c);let o=["",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,915)),"E:\\starter-template\\TN-SCXD-5.0\\app\\checkout\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,623)),"E:\\starter-template\\TN-SCXD-5.0\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],d=["E:\\starter-template\\TN-SCXD-5.0\\app\\checkout\\page.tsx"],x="/checkout/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/checkout/page",pathname:"/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8981:(e,t,s)=>{Promise.resolve().then(s.bind(s,8332))},8332:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g,dynamic:()=>y});var r=s(3854),a=s(4218),i=s(5620),l=s(7896),n=s(3984),c=s(2747),o=s(1018),d=s(5256),x=s(8954),m=s(6974),u=s(3708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,u.Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);var h=s(2978);let y="force-dynamic";function g(){let{items:e,getTotalPrice:t,clearCart:s}=(0,i.j)(),{user:u}=(0,l.useAuth)(),[y,g]=(0,a.useState)(!1),[f,j]=(0,a.useState)(!1),N=(0,o.useRouter)(),b=(0,n.JU)(),{register:v,handleSubmit:q,formState:{errors:k}}=(0,c.cI)();(0,a.useEffect)(()=>{j(!0)},[]),(0,a.useEffect)(()=>{f&&!u&&N.push("/auth/login")},[f,u,N]),(0,a.useEffect)(()=>{f&&0===e.length&&N.push("/cart")},[f,e.length,N]);let _=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(e),w=async r=>{if(!u){d.default.error("请先登录");return}if(0===e.length){d.default.error("购物车为空");return}g(!0);try{let{data:a,error:i}=await b.from("orders").insert({user_id:u.id,total_amount:t(),shipping_address:r.shippingAddress,contact_phone:r.contactPhone,notes:r.notes||null,status:"pending"}).select().single();if(i)throw i;let l=e.map(e=>({order_id:a.id,product_id:e.id,quantity:e.quantity,price:e.price})),{error:n}=await b.from("order_items").insert(l);if(n)throw n;for(let t of e){let{error:e}=await b.from("products").update({stock_quantity:t.stock_quantity-t.quantity}).eq("id",t.id);e&&console.error("Stock update error:",e)}s(),d.default.success("订单创建成功！"),N.push(`/orders/${a.id}`)}catch(e){console.error("Checkout error:",e),d.default.error("订单创建失败，请重试")}finally{g(!1)}};return f&&u&&0!==e.length?(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"确认订单"}),(0,r.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[r.jsx("div",{className:"lg:col-span-2",children:(0,r.jsxs)("div",{className:"card",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"配送信息"}),(0,r.jsxs)("form",{onSubmit:q(w),className:"space-y-6",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"shippingAddress",className:"block text-sm font-medium text-gray-700 mb-2",children:"配送地址 *"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx(x.Z,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),r.jsx("textarea",{...v("shippingAddress",{required:"请输入配送地址",minLength:{value:10,message:"地址至少10个字符"}}),rows:3,className:"input-field pl-10",placeholder:"请输入详细的配送地址，包括省市区和具体地址"})]}),k.shippingAddress&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.shippingAddress.message})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"contactPhone",className:"block text-sm font-medium text-gray-700 mb-2",children:"联系电话 *"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx(m.Z,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),r.jsx("input",{...v("contactPhone",{required:"请输入联系电话",pattern:{value:/^1[3-9]\d{9}$/,message:"请输入有效的手机号码"}}),type:"tel",className:"input-field pl-10",placeholder:"请输入您的手机号码"})]}),k.contactPhone&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.contactPhone.message})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"备注信息"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx(p,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),r.jsx("textarea",{...v("notes"),rows:3,className:"input-field pl-10",placeholder:"有什么特殊要求可以在这里备注（选填）"})]})]}),r.jsx("button",{type:"submit",disabled:y,className:"w-full btn-primary py-3 text-lg disabled:opacity-50",children:y?"处理中...":"确认下单"})]})]})}),r.jsx("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"card sticky top-8",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"订单摘要"}),r.jsx("div",{className:"space-y-4 mb-6",children:e.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center flex-shrink-0",children:e.image_url?r.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover rounded-lg"}):r.jsx(h.Z,{className:"h-6 w-6 text-gray-400"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["数量: ",e.quantity]})]}),r.jsx("p",{className:"text-sm font-medium text-gray-900",children:_(e.price*e.quantity)})]},e.id))}),(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"商品小计"}),r.jsx("span",{className:"text-sm text-gray-900",children:_(t())})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"运费"}),r.jsx("span",{className:"text-sm text-green-600",children:"免费"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[r.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"总计"}),r.jsx("span",{className:"text-xl font-bold text-primary-600",children:_(t())})]})]})]})})]})]}):r.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}},8954:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(3708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},6974:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(3708);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},915:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>i,default:()=>o,dynamic:()=>c});var r=s(5153);let a=(0,r.createProxy)(String.raw`E:\starter-template\TN-SCXD-5.0\app\checkout\page.tsx`),{__esModule:i,$$typeof:l}=a,n=a.default,c=(0,r.createProxy)(String.raw`E:\starter-template\TN-SCXD-5.0\app\checkout\page.tsx#dynamic`),o=n}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[271,502,253,692],()=>s(1069));module.exports=r})();