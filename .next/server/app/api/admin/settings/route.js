(()=>{var e={};e.id=80,e.ids=[80],e.modules={2213:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2213,e.exports=t},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8359:()=>{},3739:()=>{},6173:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>j,originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>q});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>d,PUT:()=>p});var o=r(884),a=r(6132),i=r(1040),n=r(6813),u=r(4596),c=r(5798);async function l(){try{let e=(0,n.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:t},error:r}=await e.auth.getUser();if(r||!t)return c.Z.json({error:"未授权"},{status:401});let{data:s}=await e.from("profiles").select("role").eq("id",t.id).single();if(s?.role!=="admin")return c.Z.json({error:"权限不足"},{status:403});let{data:o,error:a}=await e.from("settings").select("*").order("category",{ascending:!0}).order("key",{ascending:!0});if(a)return console.error("获取设置失败:",a),c.Z.json({error:"获取设置失败"},{status:500});return c.Z.json({data:o})}catch(e){return console.error("API错误:",e),c.Z.json({error:"服务器错误"},{status:500})}}async function d(e){try{let t=(0,n.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return c.Z.json({error:"未授权"},{status:401});let{data:o}=await t.from("profiles").select("role").eq("id",r.id).single();if(o?.role!=="admin")return c.Z.json({error:"权限不足"},{status:403});let a=await e.json(),{key:i,value:l,description:d,category:p,data_type:g,is_public:f}=a;if(!i||!l)return c.Z.json({error:"缺少必填字段"},{status:400});let{data:m,error:x}=await t.from("settings").insert([{key:i,value:l,description:d,category:p||"general",data_type:g||"string",is_public:f||!1,updated_by:r.id}]).select().single();if(x)return console.error("创建设置失败:",x),c.Z.json({error:"创建设置失败"},{status:500});return c.Z.json({data:m})}catch(e){return console.error("API错误:",e),c.Z.json({error:"服务器错误"},{status:500})}}async function p(e){try{let t=(0,n.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return c.Z.json({error:"未授权"},{status:401});let{data:o}=await t.from("profiles").select("role").eq("id",r.id).single();if(o?.role!=="admin")return c.Z.json({error:"权限不足"},{status:403});let a=await e.json(),{id:i,...l}=a;if(!i)return c.Z.json({error:"缺少设置ID"},{status:400});let{data:d,error:p}=await t.from("settings").update({...l,updated_by:r.id}).eq("id",i).select().single();if(p)return console.error("更新设置失败:",p),c.Z.json({error:"更新设置失败"},{status:500});return c.Z.json({data:d})}catch(e){return console.error("API错误:",e),c.Z.json({error:"服务器错误"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/settings/route",pathname:"/api/admin/settings",filename:"route",bundlePath:"app/api/admin/settings/route"},resolvedPagePath:"E:\\starter-template\\TN-SCXD-5.0\\app\\api\\admin\\settings\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:x,headerHooks:j,staticGenerationBailout:q}=g,y="/api/admin/settings/route";function h(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[271,741,54],()=>r(6173));module.exports=s})();