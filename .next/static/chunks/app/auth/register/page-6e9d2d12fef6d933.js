(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[454],{7216:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,a.Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},211:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,a.Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},5589:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,a.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},1295:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,a.Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},7972:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,a.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},1382:function(e,t,s){Promise.resolve().then(s.bind(s,9200))},9200:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var a=s(7437),i=s(2265),n=s(1396),r=s.n(n),l=s(4033),o=s(2899),c=s(1865),u=s(5925),d=s(7972),m=s(1295),f=s(5589),h=s(7216),p=s(211);function y(){let[e,t]=(0,i.useState)(!1),[s,n]=(0,i.useState)(!1),[y,x]=(0,i.useState)(!1),g=(0,l.useRouter)(),b=(0,o.JU)(),{register:v,handleSubmit:N,watch:j,formState:{errors:k}}=(0,c.cI)(),w=j("password"),_=async e=>{x(!0);try{let{data:t,error:s}=await b.auth.signUp({email:e.email,password:e.password,options:{data:{full_name:e.fullName}}});if(s){u.default.error(s.message);return}if(t.user){let{error:s}=await b.from("profiles").insert({id:t.user.id,email:e.email,full_name:e.fullName,role:"user"});s&&console.error("Profile creation error:",s)}u.default.success("注册成功！请检查邮箱验证链接"),g.push("/auth/login")}catch(e){u.default.error("注册失败，请重试")}finally{x(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"创建新账户"}),(0,a.jsxs)("p",{className:"mt-2 text-center text-sm text-gray-600",children:["已有账户？"," ",(0,a.jsx)(r(),{href:"/auth/login",className:"font-medium text-primary-600 hover:text-primary-500",children:"立即登录"})]})]}),(0,a.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:N(_),children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700",children:"姓名"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(d.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{...v("fullName",{required:"请输入姓名",minLength:{value:2,message:"姓名至少2个字符"}}),type:"text",className:"input-field pl-10",placeholder:"请输入您的姓名"})]}),k.fullName&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.fullName.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"邮箱地址"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(m.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{...v("email",{required:"请输入邮箱地址",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"请输入有效的邮箱地址"}}),type:"email",className:"input-field pl-10",placeholder:"请输入邮箱地址"})]}),k.email&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.email.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"密码"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(f.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{...v("password",{required:"请输入密码",minLength:{value:6,message:"密码至少6位"}}),type:e?"text":"password",className:"input-field pl-10 pr-10",placeholder:"请输入密码"}),(0,a.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>t(!e),children:e?(0,a.jsx)(h.Z,{className:"h-5 w-5 text-gray-400"}):(0,a.jsx)(p.Z,{className:"h-5 w-5 text-gray-400"})})]}),k.password&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.password.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"确认密码"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(f.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{...v("confirmPassword",{required:"请确认密码",validate:e=>e===w||"两次密码输入不一致"}),type:s?"text":"password",className:"input-field pl-10 pr-10",placeholder:"请再次输入密码"}),(0,a.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>n(!s),children:s?(0,a.jsx)(h.Z,{className:"h-5 w-5 text-gray-400"}):(0,a.jsx)(p.Z,{className:"h-5 w-5 text-gray-400"})})]}),k.confirmPassword&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.confirmPassword.message})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:y,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:y?"注册中...":"注册"})})]})]})})}},7521:function(e,t,s){"use strict";var a=s(2362),i=s(2601);class n{static getDefaultConfig(){let e="https://demo-project.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo";return e&&t?{url:e,anonKey:t,serviceRoleKey:i.env.SUPABASE_SERVICE_ROLE_KEY,connectionPool:10,timeout:30}:null}static async loadConfigFromDatabase(){try{let e=this.getDefaultConfig();if(!e)return console.warn("No default config available, cannot load from database"),null;let t=(0,a.eI)(e.url,e.anonKey),{data:s,error:i}=await t.from("settings").select("key, value").in("key",["db_url","db_anon_key","db_service_key","db_connection_pool","db_timeout"]);if(i)return console.warn("Failed to load config from database:",i),e;if(!s||0===s.length)return console.log("No database config found, using default"),e;let n={};s.forEach(e=>{switch(e.key){case"db_url":n.url=e.value;break;case"db_anon_key":n.anonKey=e.value;break;case"db_service_key":n.serviceRoleKey=e.value;break;case"db_connection_pool":n.connectionPool=parseInt(e.value)||10;break;case"db_timeout":n.timeout=parseInt(e.value)||30}});let r={url:n.url||e.url,anonKey:n.anonKey||e.anonKey,serviceRoleKey:n.serviceRoleKey||e.serviceRoleKey,connectionPool:n.connectionPool||10,timeout:n.timeout||30};return console.log("Loaded config from database successfully"),r}catch(e){return console.error("Error loading config from database:",e),this.getDefaultConfig()}}static async initialize(){if(this.instance.initialized&&this.instance.client)return this.instance.client;try{let e=await this.loadConfigFromDatabase();if(e||(e=this.getDefaultConfig()),!e)return console.error("No valid Supabase configuration found"),null;let t=(0,a.eI)(e.url,e.anonKey,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}});return this.instance.config=e,this.instance.client=t,this.instance.initialized=!0,console.log("Supabase client initialized successfully"),t}catch(e){return console.error("Failed to initialize Supabase client:",e),null}}static getClient(){return this.instance.client}static getConfig(){return this.instance.config}static async reloadConfig(){return this.instance.initialized=!1,this.instance.client=null,this.instance.config=null,await this.initialize()}static async updateConfig(e){try{let t=this.getClient();if(!t)throw Error("No client available for config update");let s=[];for(let a of(e.url&&s.push({key:"db_url",value:e.url,category:"database",is_public:!1}),e.anonKey&&s.push({key:"db_anon_key",value:e.anonKey,category:"database",is_public:!1}),e.serviceRoleKey&&s.push({key:"db_service_key",value:e.serviceRoleKey,category:"database",is_public:!1}),void 0!==e.connectionPool&&s.push({key:"db_connection_pool",value:e.connectionPool.toString(),category:"database",is_public:!1}),void 0!==e.timeout&&s.push({key:"db_timeout",value:e.timeout.toString(),category:"database",is_public:!1}),s)){let{error:e}=await t.from("settings").upsert(a,{onConflict:"key"});if(e)throw e}return await this.reloadConfig(),console.log("Database config updated successfully"),!0}catch(e){return console.error("Failed to update database config:",e),!1}}static async checkConnection(){try{let e=this.getClient();if(!e)return{connected:!1,error:"No client available"};let{data:t,error:s}=await e.from("settings").select("count").limit(1);if(s)return{connected:!1,error:s.message};return{connected:!0}}catch(e){return{connected:!1,error:e.message}}}}n.instance={config:null,client:null,initialized:!1},t.Z=n},2899:function(e,t,s){"use strict";s.d(t,{JU:function(){return n}});var a=s(2362),i=s(7521);function n(){let e=i.Z.getClient();if(e)return e;let t="https://demo-project.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo";if(!t)throw console.error("Missing NEXT_PUBLIC_SUPABASE_URL environment variable"),Error("Supabase URL is required");if(!s)throw console.error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable"),Error("Supabase Anonymous Key is required");let n=(0,a.eI)(t,s,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}});return n}n()},1396:function(e,t,s){e.exports=s(8326)}},function(e){e.O(0,[199,326,535,971,472,744],function(){return e(e.s=1382)}),_N_E=e.O()}]);