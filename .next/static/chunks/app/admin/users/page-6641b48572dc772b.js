(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{8936:function(e,s,l){Promise.resolve().then(l.bind(l,8734))},8734:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return f}});var a=l(7437),t=l(2265),r=l(2899),i=l(3504),c=l(5925),d=l(1827),n=l(2482),x=l(7972),m=l(9036),h=l(1295),o=l(8203),u=l(632),p=l(3361);function f(){let[e,s]=(0,t.useState)([]),[l,f]=(0,t.useState)(!0),[j,g]=(0,t.useState)(""),[N,v]=(0,t.useState)(""),y=(0,r.JU)();(0,t.useEffect)(()=>{w()},[]);let w=async()=>{f(!0);let e=y.from("profiles").select("*").order("created_at",{ascending:!1});j&&(e=e.or("email.ilike.%".concat(j,"%,full_name.ilike.%").concat(j,"%"))),N&&(e=e.eq("role",N));let{data:l}=await e;l&&s(l),f(!1)};(0,t.useEffect)(()=>{let e=setTimeout(()=>{w()},300);return()=>clearTimeout(e)},[j,N]);let b=async(e,s)=>{try{let{error:l}=await y.from("profiles").update({role:s}).eq("id",e);if(l)throw l;c.default.success("用户角色更新成功"),w()}catch(e){console.error("Error updating user role:",e),c.default.error("更新失败，请重试")}},k=e=>(0,u.Z)(new Date(e),"yyyy年MM月dd日",{locale:p.Z}),_=e=>{switch(e){case"admin":return"bg-red-100 text-red-800";case"user":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},Z=e=>{switch(e){case"admin":return"管理员";case"user":return"普通用户";default:return e}},E=[{value:"user",label:"普通用户"},{value:"admin",label:"管理员"}];return(0,a.jsx)(i.Z,{children:(0,a.jsxs)("div",{className:"px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"sm:flex sm:items-center",children:(0,a.jsxs)("div",{className:"sm:flex-auto",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"用户管理"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-700",children:"管理所有用户信息和权限"})]})}),(0,a.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,a.jsx)(d.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,a.jsx)("input",{type:"text",placeholder:"搜索用户邮箱或姓名...",className:"input-field pl-10",value:j,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,a.jsxs)("select",{className:"input-field pl-10 pr-10 appearance-none bg-white",value:N,onChange:e=>v(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"所有角色"}),E.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]})]}),(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3",children:[(0,a.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(x.Z,{className:"h-6 w-6 text-gray-400"})}),(0,a.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,a.jsxs)("dl",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"总用户数"}),(0,a.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:e.length})]})})]})})}),(0,a.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(m.Z,{className:"h-6 w-6 text-red-400"})}),(0,a.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,a.jsxs)("dl",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"管理员"}),(0,a.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:e.filter(e=>"admin"===e.role).length})]})})]})})}),(0,a.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(x.Z,{className:"h-6 w-6 text-green-400"})}),(0,a.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,a.jsxs)("dl",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"普通用户"}),(0,a.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:e.filter(e=>"customer"===e.role).length})]})})]})})})]}),(0,a.jsx)("div",{className:"mt-8 flex flex-col",children:(0,a.jsx)("div",{className:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,a.jsx)("div",{className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-300",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用户信息"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"邮箱"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"角色"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"注册时间"}),(0,a.jsx)("th",{className:"relative px-6 py-3",children:(0,a.jsx)("span",{className:"sr-only",children:"操作"})})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-6 py-4 text-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"})})}):0===e.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:"暂无用户"})}):e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,a.jsx)("div",{className:"h-10 w-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.avatar_url?(0,a.jsx)("img",{src:e.avatar_url,alt:e.full_name||e.email,className:"h-10 w-10 rounded-full"}):(0,a.jsx)(x.Z,{className:"h-5 w-5 text-gray-400"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.full_name||"未设置"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id.slice(0,8),"..."]})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.email})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("select",{value:e.role,onChange:s=>b(e.id,s.target.value),className:"text-xs font-medium rounded-full px-2.5 py-0.5 border-0 ".concat(_(e.role)),children:E.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:k(e.created_at)})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(_(e.role)),children:Z(e.role)})})]},e.id))})]})})})})})]})})}}},function(e){e.O(0,[199,326,732,222,504,971,472,744],function(){return e(e.s=8936)}),_N_E=e.O()}]);