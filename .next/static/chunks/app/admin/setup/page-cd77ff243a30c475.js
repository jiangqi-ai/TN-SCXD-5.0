(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[334],{7972:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});var a=t(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},5205:function(e,s,t){Promise.resolve().then(t.bind(t,6419))},6419:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return x}});var a=t(7437),r=t(2265),l=t(4033),i=t(2899),n=t(7332),d=t(519),c=t(7972),o=t(9409),m=t(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,m.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var b=t(5925);function x(){let e=(0,l.useRouter)(),[s,t]=(0,r.useState)(0),[m,x]=(0,r.useState)(!1),[h,p]=(0,r.useState)({url:"https://demo-project.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo",serviceRoleKey:"",connectionPool:10,timeout:30}),[g,f]=(0,r.useState)({email:"admin@climbing-gear.com",password:"",fullName:"系统管理员"}),[y,j]=(0,r.useState)([{id:"database",title:"数据库配置",description:"配置 Supabase 数据库连接参数",completed:!1,required:!0},{id:"admin",title:"创建管理员账户",description:"设置系统管理员账户",completed:!1,required:!0},{id:"settings",title:"系统设置",description:"配置基本系统参数",completed:!1,required:!1}]),v=(0,i.JU)();(0,r.useEffect)(()=>{N()},[]);let N=async()=>{try{let{data:e}=await v.from("settings").select("count").limit(1);e&&w("database",!0);let{data:s}=await v.from("profiles").select("id").eq("role","admin").limit(1);s&&s.length>0&&w("admin",!0);let{data:t}=await v.from("settings").select("id").limit(1);t&&t.length>0&&w("settings",!0)}catch(e){console.log("检查设置状态时出错:",e)}},w=(e,s)=>{j(t=>t.map(t=>t.id===e?{...t,completed:s}:t))},k=async()=>{x(!0);try{let{data:e,error:s}=await v.from("settings").select("count").limit(1);if(s)throw s;w("database",!0),b.default.success("数据库连接测试成功！"),await _()}catch(e){console.error("数据库连接测试失败:",e),b.default.error("数据库连接测试失败，请检查配置")}finally{x(!1)}},_=async()=>{try{let e=[{key:"db_url",value:h.url,category:"database",is_public:!1},{key:"db_anon_key",value:h.anonKey,category:"database",is_public:!1},{key:"db_service_key",value:h.serviceRoleKey,category:"database",is_public:!1},{key:"db_connection_pool",value:h.connectionPool.toString(),category:"database",is_public:!1},{key:"db_timeout",value:h.timeout.toString(),category:"database",is_public:!1}];for(let s of e)await v.from("settings").upsert(s,{onConflict:"key"});b.default.success("数据库配置已保存")}catch(e){console.error("保存数据库配置失败:",e),b.default.error("保存数据库配置失败")}},I=async()=>{x(!0);try{let{data:e,error:s}=await v.auth.signUp({email:g.email,password:g.password});if(s)throw s;if(e.user){let{error:s}=await v.from("profiles").insert([{id:e.user.id,email:g.email,full_name:g.fullName,role:"admin"}]);if(s)throw s;w("admin",!0),b.default.success("管理员账户创建成功！")}}catch(e){console.error("创建管理员账户失败:",e),b.default.error("创建管理员账户失败: ".concat(e.message))}finally{x(!1)}},C=async()=>{x(!0);try{let e=[{key:"site_name",value:"攀岩装备专营店",category:"general",is_public:!0},{key:"site_description",value:"专业的攀岩装备在线购买平台",category:"general",is_public:!0},{key:"contact_email",value:g.email,category:"contact",is_public:!0},{key:"setup_completed",value:"true",category:"system",is_public:!1},{key:"setup_date",value:new Date().toISOString(),category:"system",is_public:!1}];for(let s of e)await v.from("settings").upsert(s,{onConflict:"key"});w("settings",!0),b.default.success("系统设置初始化完成！")}catch(e){console.error("初始化系统设置失败:",e),b.default.error("初始化系统设置失败")}finally{x(!1)}},S=y.filter(e=>e.required).every(e=>e.completed);return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"攀岩装备系统设置"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"欢迎！请按照以下步骤完成系统初始化配置"})]}),(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:y.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full ".concat(e.completed?"bg-green-500 text-white":s===t?"bg-blue-500 text-white":"bg-gray-300 text-gray-500"),children:e.completed?(0,a.jsx)(u,{className:"h-4 w-4"}):t+1}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat(e.completed?"text-green-600":"text-gray-900"),children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.description})]}),t<y.length-1&&(0,a.jsx)("div",{className:"w-16 h-0.5 mx-4 ".concat(e.completed?"bg-green-500":"bg-gray-300")})]},e.id))})}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[0===s&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(n.Z,{className:"h-5 w-5 text-blue-400 mr-3 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"数据库配置说明"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-blue-700",children:"请填入您的 Supabase 项目配置信息。这些信息可以在 Supabase Dashboard 的 Settings → API 中找到。"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"项目URL"}),(0,a.jsx)("input",{type:"url",value:h.url,onChange:e=>p(s=>({...s,url:e.target.value})),placeholder:"https://your-project-id.supabase.co",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"公开密钥 (anon key)"}),(0,a.jsx)("textarea",{value:h.anonKey,onChange:e=>p(s=>({...s,anonKey:e.target.value})),placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"服务密钥 (service_role key)"}),(0,a.jsx)("textarea",{value:h.serviceRoleKey,onChange:e=>p(s=>({...s,serviceRoleKey:e.target.value})),placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"连接池大小"}),(0,a.jsx)("input",{type:"number",value:h.connectionPool,onChange:e=>p(s=>({...s,connectionPool:parseInt(e.target.value)})),min:"1",max:"50",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"超时时间（秒）"}),(0,a.jsx)("input",{type:"number",value:h.timeout,onChange:e=>p(s=>({...s,timeout:parseInt(e.target.value)})),min:"5",max:"120",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:k,disabled:m||!h.url||!h.anonKey,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:[m?(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(n.Z,{className:"h-4 w-4 mr-2"}),"测试连接"]})})]}),1===s&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 text-green-400 mr-3 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"管理员账户"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-green-700",children:"创建系统管理员账户，用于访问管理后台和系统配置。"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"邮箱地址"}),(0,a.jsx)("input",{type:"email",value:g.email,onChange:e=>f(s=>({...s,email:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"密码"}),(0,a.jsx)("input",{type:"password",value:g.password,onChange:e=>f(s=>({...s,password:e.target.value})),placeholder:"请设置强密码（至少8个字符）",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"姓名"}),(0,a.jsx)("input",{type:"text",value:g.fullName,onChange:e=>f(s=>({...s,fullName:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:I,disabled:m||!g.email||!g.password||g.password.length<8,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[m?(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"创建管理员"]})})]}),2===s&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 text-purple-400 mr-3 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-purple-800",children:"系统设置"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-purple-700",children:"初始化系统基本设置，后续可在管理后台进行修改。"})]})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:C,disabled:m,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 disabled:opacity-50",children:[m?(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"初始化设置"]})})]}),(0,a.jsxs)("div",{className:"mt-8 flex justify-between",children:[(0,a.jsx)("button",{onClick:()=>t(Math.max(0,s-1)),disabled:0===s,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"上一步"}),s<y.length-1?(0,a.jsx)("button",{onClick:()=>t(Math.min(y.length-1,s+1)),disabled:y[s].required&&!y[s].completed,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:"下一步"}):(0,a.jsxs)("button",{onClick:()=>{b.default.success("系统设置完成！正在跳转到管理后台..."),setTimeout(()=>{e.push("/admin")},2e3)},disabled:!S,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[(0,a.jsx)(u,{className:"h-4 w-4 mr-2"}),"完成设置"]})]})]})]})})}},2899:function(e,s,t){"use strict";t.d(s,{JU:function(){return l}});var a=t(2362),r=t(7521);function l(){let e=r.Z.getClient();if(e)return e;let s="https://demo-project.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo";if(!s)throw console.error("Missing NEXT_PUBLIC_SUPABASE_URL environment variable"),Error("Supabase URL is required");if(!t)throw console.error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable"),Error("Supabase Anonymous Key is required");let l=(0,a.eI)(s,t,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}});return l}l()},4033:function(e,s,t){e.exports=t(94)}},function(e){e.O(0,[199,939,971,472,744],function(){return e(e.s=5205)}),_N_E=e.O()}]);