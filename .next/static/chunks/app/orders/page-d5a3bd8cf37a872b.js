(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{6142:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var n=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,n.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},9270:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var n=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,n.Z)("Mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]])},2741:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var n=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,n.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},1685:function(e,t,s){Promise.resolve().then(s.bind(s,5737))},5737:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var n=s(7437),a=s(2265),i=s(2899),r=s(610),l=s(4033),c=s(4322),o=s(9270),d=s(6142),u=s(2741),m=s(632),x=s(3361);function h(){let[e,t]=(0,a.useState)([]),[s,h]=(0,a.useState)(!0),[f,g]=(0,a.useState)(null),[y,p]=(0,a.useState)(!1),{user:b}=(0,r.useAuth)(),v=(0,l.useRouter)(),j=(0,i.JU)();(0,a.useEffect)(()=>{if(!b){v.push("/auth/login");return}N()},[b]);let N=async()=>{if(!b)return;h(!0);let{data:e}=await j.from("orders").select("\n        *,\n        order_items (\n          id,\n          quantity,\n          price,\n          products (\n            name,\n            image_url\n          )\n        )\n      ").eq("user_id",b.id).order("created_at",{ascending:!1});e&&t(e),h(!1)},_=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(e),w=e=>(0,m.Z)(new Date(e),"yyyy年MM月dd日 HH:mm",{locale:x.Z}),k=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},C=e=>{switch(e){case"pending":return"待处理";case"processing":return"处理中";case"shipped":return"已发货";case"delivered":return"已送达";case"cancelled":return"已取消";default:return e}},S=e=>{g(e),p(!0)},E=()=>{p(!1),g(null)};return b?(0,n.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"我的订单"}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:"查看您的所有订单信息和状态"})]}),s?(0,n.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):0===e.length?(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)(c.Z,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无订单"}),(0,n.jsx)("p",{className:"text-gray-500 mb-8",children:"您还没有任何订单记录"}),(0,n.jsx)("button",{onClick:()=>v.push("/products"),className:"btn-primary",children:"开始购物"})]}):(0,n.jsx)("div",{className:"space-y-6",children:e.map(e=>(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,n.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,n.jsx)("div",{className:"flex items-center space-x-4",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["订单号: #",e.id.slice(0,8)]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["下单时间: ",w(e.created_at)]})]})}),(0,n.jsxs)("div",{className:"mt-4 sm:mt-0 flex items-center space-x-4",children:[(0,n.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(k(e.status)),children:C(e.status)}),(0,n.jsx)("button",{onClick:()=>S(e),className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:"查看详情"})]})]})}),(0,n.jsx)("div",{className:"px-6 py-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.order_items.slice(0,4).map(e=>(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0 w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:e.products.image_url?(0,n.jsx)("img",{src:e.products.image_url,alt:e.products.name,className:"w-12 h-12 object-cover rounded-lg"}):(0,n.jsx)(o.Z,{className:"h-6 w-6 text-gray-400"})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.products.name}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["数量: ",e.quantity]})]})]},e.id)),e.order_items.length>4&&(0,n.jsxs)("div",{className:"flex items-center justify-center text-sm text-gray-500",children:["还有 ",e.order_items.length-4," 件商品..."]})]})}),(0,n.jsxs)("div",{className:"ml-6 text-right",children:[(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"订单总额"}),(0,n.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:_(e.total_amount)})]})]})})]},e.id))}),y&&f&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,n.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,n.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:E}),(0,n.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",children:[(0,n.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:["订单详情 #",f.id.slice(0,8)]}),(0,n.jsx)("button",{onClick:E,className:"text-gray-400 hover:text-gray-500",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"订单状态"}),(0,n.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(k(f.status)),children:C(f.status)})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"下单时间"}),(0,n.jsx)("span",{className:"text-sm text-gray-900",children:w(f.created_at)})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center",children:[(0,n.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"配送信息"]}),(0,n.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg space-y-2",children:[(0,n.jsx)("p",{className:"text-sm text-gray-900",children:f.shipping_address}),(0,n.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,n.jsx)(u.Z,{className:"h-4 w-4 mr-1"}),f.shipping_phone]}),f.notes&&(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,n.jsx)("strong",{children:"备注："}),f.notes]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center",children:[(0,n.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"商品列表"]}),(0,n.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:f.order_items.map(e=>(0,n.jsxs)("div",{className:"flex items-center p-3 border-b border-gray-200 last:border-b-0",children:[(0,n.jsx)("div",{className:"flex-shrink-0 w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:e.products.image_url?(0,n.jsx)("img",{src:e.products.image_url,alt:e.products.name,className:"w-12 h-12 object-cover rounded-lg"}):(0,n.jsx)(o.Z,{className:"h-6 w-6 text-gray-400"})}),(0,n.jsxs)("div",{className:"ml-3 flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.products.name}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["数量: ",e.quantity," \xd7 ",_(e.price)]})]}),(0,n.jsx)("div",{className:"text-sm font-medium text-gray-900",children:_(e.quantity*e.price)})]},e.id))})]}),(0,n.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-lg font-medium text-gray-900",children:"订单总计"}),(0,n.jsx)("span",{className:"text-xl font-bold text-primary-600",children:_(f.total_amount)})]})})]})]}),(0,n.jsx)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:(0,n.jsx)("button",{onClick:E,className:"btn-secondary",children:"关闭"})})]})]})})]}):null}},610:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c},useAuth:function(){return l}});var n=s(7437),a=s(2265),i=s(2899);let r=(0,a.createContext)(void 0);function l(){let e=(0,a.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(e){let{children:t}=e,[s,l]=(0,a.useState)(null),[c,o]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),m=(0,i.JU)(),x=async()=>{if(!s)return;let{data:e}=await m.from("profiles").select("*").eq("id",s.id).single();o(e)},h=async()=>{await m.auth.signOut(),l(null),o(null)};return(0,a.useEffect)(()=>{let e=async()=>{let{data:{user:e}}=await m.auth.getUser();l(e),e&&await x(),u(!1)};e();let{data:{subscription:t}}=m.auth.onAuthStateChange(async(e,t)=>{var s;l(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),(null==t?void 0:t.user)?await x():o(null),u(!1)});return()=>t.unsubscribe()},[null==s?void 0:s.id]),(0,n.jsx)(r.Provider,{value:{user:s,profile:c,loading:d,signOut:h,refreshProfile:x},children:t})}},7521:function(e,t,s){"use strict";var n=s(2362),a=s(2601);class i{static getDefaultConfig(){let e="https://demo-project.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo";return e&&t?{url:e,anonKey:t,serviceRoleKey:a.env.SUPABASE_SERVICE_ROLE_KEY,connectionPool:10,timeout:30}:null}static async loadConfigFromDatabase(){try{let e=this.getDefaultConfig();if(!e)return console.warn("No default config available, cannot load from database"),null;let t=(0,n.eI)(e.url,e.anonKey),{data:s,error:a}=await t.from("settings").select("key, value").in("key",["db_url","db_anon_key","db_service_key","db_connection_pool","db_timeout"]);if(a)return console.warn("Failed to load config from database:",a),e;if(!s||0===s.length)return console.log("No database config found, using default"),e;let i={};s.forEach(e=>{switch(e.key){case"db_url":i.url=e.value;break;case"db_anon_key":i.anonKey=e.value;break;case"db_service_key":i.serviceRoleKey=e.value;break;case"db_connection_pool":i.connectionPool=parseInt(e.value)||10;break;case"db_timeout":i.timeout=parseInt(e.value)||30}});let r={url:i.url||e.url,anonKey:i.anonKey||e.anonKey,serviceRoleKey:i.serviceRoleKey||e.serviceRoleKey,connectionPool:i.connectionPool||10,timeout:i.timeout||30};return console.log("Loaded config from database successfully"),r}catch(e){return console.error("Error loading config from database:",e),this.getDefaultConfig()}}static async initialize(){if(this.instance.initialized&&this.instance.client)return this.instance.client;try{let e=await this.loadConfigFromDatabase();if(e||(e=this.getDefaultConfig()),!e)return console.error("No valid Supabase configuration found"),null;let t=(0,n.eI)(e.url,e.anonKey,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}});return this.instance.config=e,this.instance.client=t,this.instance.initialized=!0,console.log("Supabase client initialized successfully"),t}catch(e){return console.error("Failed to initialize Supabase client:",e),null}}static getClient(){return this.instance.client}static getConfig(){return this.instance.config}static async reloadConfig(){return this.instance.initialized=!1,this.instance.client=null,this.instance.config=null,await this.initialize()}static async updateConfig(e){try{let t=this.getClient();if(!t)throw Error("No client available for config update");let s=[];for(let n of(e.url&&s.push({key:"db_url",value:e.url,category:"database",is_public:!1}),e.anonKey&&s.push({key:"db_anon_key",value:e.anonKey,category:"database",is_public:!1}),e.serviceRoleKey&&s.push({key:"db_service_key",value:e.serviceRoleKey,category:"database",is_public:!1}),void 0!==e.connectionPool&&s.push({key:"db_connection_pool",value:e.connectionPool.toString(),category:"database",is_public:!1}),void 0!==e.timeout&&s.push({key:"db_timeout",value:e.timeout.toString(),category:"database",is_public:!1}),s)){let{error:e}=await t.from("settings").upsert(n,{onConflict:"key"});if(e)throw e}return await this.reloadConfig(),console.log("Database config updated successfully"),!0}catch(e){return console.error("Failed to update database config:",e),!1}}static async checkConnection(){try{let e=this.getClient();if(!e)return{connected:!1,error:"No client available"};let{data:t,error:s}=await e.from("settings").select("count").limit(1);if(s)return{connected:!1,error:s.message};return{connected:!0}}catch(e){return{connected:!1,error:e.message}}}}i.instance={config:null,client:null,initialized:!1},t.Z=i},2899:function(e,t,s){"use strict";s.d(t,{JU:function(){return i}});var n=s(2362),a=s(7521);function i(){let e=a.Z.getClient();if(e)return e;let t="https://demo-project.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.demo";if(!t)throw console.error("Missing NEXT_PUBLIC_SUPABASE_URL environment variable"),Error("Supabase URL is required");if(!s)throw console.error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable"),Error("Supabase Anonymous Key is required");let i=(0,n.eI)(t,s,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}});return i}i()}},function(e){e.O(0,[199,732,971,472,744],function(){return e(e.s=1685)}),_N_E=e.O()}]);