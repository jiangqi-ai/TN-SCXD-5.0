# 🛠️ 管理员账户与数据库配置指南

## 概述

本指南将帮助您完成攀岩装备系统的初始化配置，包括：
- 数据库配置管理
- 管理员账户创建
- 系统初始化设置

## 🚀 快速开始

### 方法一：自动配置（推荐）

1. **访问系统初始化页面**
   ```
   http://localhost:3000/admin/setup
   ```

2. **按照向导完成三个步骤：**
   - 步骤1：数据库配置
   - 步骤2：创建管理员账户
   - 步骤3：系统设置初始化

### 方法二：手动配置

如果您已经有基本的环境变量配置，可以直接访问管理后台进行配置：

1. **数据库配置**
   ```
   http://localhost:3000/admin/database-config
   ```

2. **管理员账户管理**
   ```
   http://localhost:3000/admin/users
   ```

## 🔧 详细配置步骤

### 1. 数据库配置

#### 1.1 获取 Supabase 配置信息

1. 登录 [Supabase Dashboard](https://supabase.com/dashboard)
2. 创建新项目或选择现有项目
3. 进入 `Settings` → `API`
4. 复制以下信息：
   - **Project URL**: `https://xxx.supabase.co`
   - **anon public key**: `eyJhbGciOiJIUzI1...`
   - **service_role key**: `eyJhbGciOiJIUzI1...` (可选)

#### 1.2 在管理后台配置

1. 访问 `/admin/database-config`
2. 填入 Supabase 配置信息
3. 调整性能参数（连接池大小、超时时间）
4. 点击"测试连接"验证配置
5. 保存配置

#### 1.3 配置参数说明

| 参数 | 说明 | 必填 | 默认值 |
|------|------|------|--------|
| 项目 URL | Supabase 项目的完整 URL | ✅ | - |
| 公开密钥 | 用于客户端认证 | ✅ | - |
| 服务密钥 | 用于后台管理操作 | ❌ | - |
| 连接池大小 | 最大并发连接数 | ❌ | 10 |
| 超时时间 | 操作超时秒数 | ❌ | 30 |

### 2. 管理员账户创建

#### 2.1 通过初始化向导

在 `/admin/setup` 页面的第二步中：
1. 填写管理员邮箱
2. 设置强密码（至少8个字符）
3. 输入管理员姓名
4. 点击"创建管理员"

#### 2.2 通过用户管理页面

1. 访问 `/admin/users`
2. 点击"添加用户"
3. 选择角色为"管理员"
4. 填写用户信息并保存

#### 2.3 密码要求

- 最少8个字符
- 建议包含大小写字母、数字和特殊字符
- 避免使用常见密码

### 3. 系统设置初始化

系统会自动创建以下默认设置：

```javascript
{
  site_name: '攀岩装备专营店',
  site_description: '专业的攀岩装备在线购买平台',
  contact_email: '管理员邮箱',
  setup_completed: 'true',
  setup_date: '当前时间'
}
```

## 🔒 安全配置

### 1. 数据库安全

- **服务密钥保护**: 服务密钥具有完全访问权限，请妥善保管
- **定期更换**: 建议定期更换密钥
- **最小权限**: 只在必要时使用服务密钥

### 2. 账户安全

- **强密码策略**: 要求所有管理员使用强密码
- **定期审查**: 定期检查管理员账户列表
- **权限控制**: 严格控制管理员权限分配

### 3. 配置安全

- **备份配置**: 定期备份数据库配置
- **访问日志**: 监控配置更改记录
- **环境隔离**: 开发和生产环境使用不同配置

## 🔄 动态配置管理

### 配置优先级

系统按以下优先级读取配置：

1. **数据库中的配置** (最高优先级)
2. **环境变量配置** (回退选项)

### 配置更新流程

1. 在管理后台修改配置
2. 系统自动保存到数据库
3. 配置立即生效，无需重启应用
4. 可通过"重新加载"按钮刷新配置

### 配置监控

- **连接状态监控**: 实时显示数据库连接状态
- **性能指标**: 监控连接池使用情况
- **错误告警**: 配置错误时显示详细信息

## 🛠️ 故障排除

### 常见问题

#### 1. 数据库连接失败

**症状**: 显示"连接失败"状态
**解决方案**:
- 检查 Supabase URL 是否正确
- 验证密钥是否有效
- 确认网络连接正常
- 检查 Supabase 项目状态

#### 2. 管理员账户创建失败

**症状**: 账户创建时报错
**解决方案**:
- 确认邮箱格式正确
- 检查密码强度
- 验证数据库连接正常
- 查看控制台错误信息

#### 3. 配置保存失败

**症状**: 保存配置时出现错误
**解决方案**:
- 检查必填字段是否完整
- 验证数值范围是否正确
- 确认用户权限足够
- 重试保存操作

### 调试方法

#### 1. 查看浏览器控制台

```javascript
// 在浏览器控制台中查看错误
console.log('Supabase配置状态:', SupabaseConfigManager.getConfig())
```

#### 2. 检查网络请求

- 打开浏览器开发者工具
- 查看 Network 标签
- 检查 API 请求是否成功

#### 3. 查看应用日志

```bash
# 在终端中查看应用日志
npm run dev
```

## 📝 最佳实践

### 1. 初始化流程

1. 首先完成数据库配置
2. 测试连接确保正常
3. 创建第一个管理员账户
4. 初始化系统设置
5. 验证所有功能正常

### 2. 日常维护

- 定期检查数据库连接状态
- 监控系统设置变更
- 备份重要配置数据
- 更新密码和密钥

### 3. 团队协作

- 为每个管理员创建独立账户
- 记录配置变更历史
- 建立配置审批流程
- 定期进行安全审查

## 🔗 相关链接

- [Supabase 官方文档](https://supabase.com/docs)
- [Next.js 官方文档](https://nextjs.org/docs)
- [项目设置指南](./SUPABASE_SETUP.md)

## 🤝 技术支持

如果您在配置过程中遇到问题，请：

1. 查看本指南的故障排除部分
2. 检查浏览器控制台错误信息
3. 参考 Supabase 官方文档
4. 联系技术支持团队

---

**注意**: 请妥善保管您的数据库配置信息，特别是服务密钥。建议在生产环境中使用更严格的安全策略。 